---
phase: 01-theming-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/plugins/interactive-dashboard/components/cards/PieChartCard.vue
  - src/plugins/interactive-dashboard/components/cards/HistogramCard.vue
  - src/plugins/interactive-dashboard/components/cards/ScatterCard.vue
autonomous: true

must_haves:
  truths:
    - "PieChartCard uses StyleManager for background and text colors"
    - "HistogramCard uses StyleManager for bar and grid colors"
    - "ScatterCard uses StyleManager for highlight and selection colors"
    - "All three cards respond correctly to theme changes"
  artifacts:
    - path: "src/plugins/interactive-dashboard/components/cards/PieChartCard.vue"
      provides: "Theme-aware pie chart"
      contains: "StyleManager|getColor"
    - path: "src/plugins/interactive-dashboard/components/cards/HistogramCard.vue"
      provides: "Theme-aware histogram"
      contains: "StyleManager|getColor"
    - path: "src/plugins/interactive-dashboard/components/cards/ScatterCard.vue"
      provides: "Theme-aware scatter plot"
      contains: "StyleManager|getColor"
  key_links:
    - from: "PieChartCard.vue"
      to: "StyleManager"
      via: "import and getColor calls"
      pattern: "StyleManager\\.getInstance\\(\\)"
---

<objective>
Migrate the three chart cards (PieChartCard, HistogramCard, ScatterCard) to use centralized theme colors from StyleManager, replacing hardcoded hex values for backgrounds, text, grids, and interaction states.

Purpose: Complete the migration of all interactive dashboard cards to use centralized theming.

Output: All three chart cards using StyleManager for theme-dependent colors.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-theming-foundation/01-CONTEXT.md
@.planning/phases/01-theming-foundation/01-01-SUMMARY.md
@src/plugins/interactive-dashboard/components/cards/PieChartCard.vue
@src/plugins/interactive-dashboard/components/cards/HistogramCard.vue
@src/plugins/interactive-dashboard/components/cards/ScatterCard.vue
@src/plugins/interactive-dashboard/managers/StyleManager.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate PieChartCard to use StyleManager</name>
  <files>src/plugins/interactive-dashboard/components/cards/PieChartCard.vue</files>
  <action>
Replace hardcoded colors in PieChartCard.vue:

1. **Import StyleManager**:
   ```typescript
   import { StyleManager } from '../../managers/StyleManager'
   ```

2. **Replace theme-aware colors in renderChart()** (~line 69-136):
   Current hardcoded values:
   ```typescript
   // Line 73-75 - replace these:
   const bgColor = isDarkMode.value ? '#1e293b' : '#ffffff'
   const textColor = isDarkMode.value ? '#e2e8f0' : '#374151'
   const lineColor = isDarkMode.value ? '#334155' : '#e5e7eb'
   ```

   Replace with:
   ```typescript
   const styleManager = StyleManager.getInstance()
   const bgColor = styleManager.getColor('theme.background.primary')
   const textColor = styleManager.getColor('theme.text.primary')
   const lineColor = styleManager.getColor('theme.border.default')
   ```

3. **Selected slice highlighting** (~line 94-99):
   - The selected slice border color uses `isDarkMode.value ? '#f8fafc' : '#ffffff'`
   - Keep this logic OR use a new StyleManager key for "contrast" color

4. **Keep category colors from colorSchemes.ts** - these are domain colors, not theme colors:
   - `getCategoryColor()` and `buildColorMap()` calls should remain unchanged

5. **Update legend colors** (~line 122-129):
   - `font: { color: textColor }` already uses the computed textColor - good

6. **Plotly layout paper_bgcolor and plot_bgcolor**:
   - Already using computed bgColor - just need to source from StyleManager
  </action>
  <verify>
    - PieChartCard renders correctly in both themes
    - Legend text is readable
    - Selected slices show white border (contrast)
    - Theme switch updates colors without refresh
  </verify>
  <done>
    - PieChartCard uses StyleManager for all theme colors
    - Category colors remain domain-specific (unchanged)
    - Theme switching works correctly
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate HistogramCard to use StyleManager</name>
  <files>src/plugins/interactive-dashboard/components/cards/HistogramCard.vue</files>
  <action>
Replace hardcoded colors in HistogramCard.vue:

1. **Import StyleManager**:
   ```typescript
   import { StyleManager } from '../../managers/StyleManager'
   ```

2. **Replace theme-aware colors in renderChart()** (~line 130-198):
   Current hardcoded values:
   ```typescript
   // Lines 134-138 - replace these:
   const bgColor = isDarkMode.value ? '#1e293b' : '#ffffff'
   const textColor = isDarkMode.value ? '#e2e8f0' : '#374151'
   const gridColor = isDarkMode.value ? '#334155' : '#e5e7eb'
   const barColor = isDarkMode.value ? '#60a5fa' : '#3b82f6'
   const selectedColor = isDarkMode.value ? '#f87171' : '#ef4444'
   ```

   Replace with:
   ```typescript
   const styleManager = StyleManager.getInstance()
   const bgColor = styleManager.getColor('theme.background.primary')
   const textColor = styleManager.getColor('theme.text.primary')
   const gridColor = styleManager.getColor('theme.border.default')
   const barColor = styleManager.getColor('chart.bar.default')
   const selectedColor = styleManager.getColor('chart.bar.selected')
   ```

3. **Bar border color** (~line 153):
   - `color: isDarkMode.value ? '#1e293b' : '#ffffff'`
   - Replace with: `color: styleManager.getColor('theme.background.primary')`

4. **Axis styling** (~line 161-187):
   - All references to textColor, gridColor already use computed variables - good
   - Just need to change the source

5. **Ensure selected bins are visually distinct**:
   - The selectedColor should provide good contrast
   - Add comment noting this is for user selection feedback
  </action>
  <verify>
    - HistogramCard renders correctly in both themes
    - Bars are visible and have good contrast
    - Selected bars are clearly distinguishable (red/orange)
    - Grid lines are subtle but visible
    - Axis labels readable
  </verify>
  <done>
    - HistogramCard uses StyleManager for all theme colors
    - Selected state uses consistent chart.bar.selected color
    - Theme switching works correctly
  </done>
</task>

<task type="auto">
  <name>Task 3: Migrate ScatterCard to use StyleManager</name>
  <files>src/plugins/interactive-dashboard/components/cards/ScatterCard.vue</files>
  <action>
Replace hardcoded colors in ScatterCard.vue:

1. **Import StyleManager and helpers**:
   ```typescript
   import { StyleManager } from '../../managers/StyleManager'
   import { getInteractionColorRGBA } from '../../utils/colorSchemes'
   ```

2. **Replace hardcoded color palette** (~line 117-126):
   Current:
   ```typescript
   const colorPalette = [
     '#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd',
     '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf',
     '#aec7e8', '#ffbb78', '#98df8a', '#ff9896', '#c5b0d5'
   ]
   ```
   - These are D3's category colors - they can remain as domain colors
   - Add comment: `// D3 categorical palette - domain-specific, not theme-dependent`

3. **Replace theme colors in renderChart()** (~line 200-357):
   Current hardcoded values (~line 204-209):
   ```typescript
   const bgColor = isDarkMode.value ? '#1e293b' : '#ffffff'
   const textColor = isDarkMode.value ? '#e2e8f0' : '#374151'
   const gridColor = isDarkMode.value ? '#334155' : '#e5e7eb'
   const defaultColor = isDarkMode.value ? '#60a5fa' : '#3b82f6'
   const highlightColor = isDarkMode.value ? '#fbbf24' : '#f59e0b'
   const selectedColor = isDarkMode.value ? '#f87171' : '#ef4444'
   ```

   Replace with:
   ```typescript
   const styleManager = StyleManager.getInstance()
   const bgColor = styleManager.getColor('theme.background.primary')
   const textColor = styleManager.getColor('theme.text.primary')
   const gridColor = styleManager.getColor('theme.border.default')
   const defaultColor = styleManager.getColor('chart.bar.default')
   const highlightColor = styleManager.getColor('interaction.hover')
   const selectedColor = styleManager.getColor('interaction.selected')
   ```

4. **Marker line colors** (~line 276, 314):
   - `color: isDarkMode.value ? '#ffffff' : '#1e293b'`
   - This is intentionally contrasting with background - could use:
   ```typescript
   color: styleManager.getColor('theme.background.primary') // for dark mode gets #1e293b
   ```
   - Or invert: use text color for outline

5. **Default point color** (line ~172-173 in computed):
   - `colors.push(isDarkMode.value ? '#60a5fa' : '#3b82f6')`
   - Replace with StyleManager call

6. **Legend styling** (~line 342-350):
   - `font: { color: textColor }` - already uses computed, just change source
  </action>
  <verify>
    - ScatterCard renders correctly in both themes
    - Points are visible with good contrast
    - Hovered points show orange highlight (consistent with MapCard)
    - Selected points show blue/red highlight (matching interaction state)
    - Legend readable in both themes
  </verify>
  <done>
    - ScatterCard uses StyleManager for all theme colors
    - Interaction states (hover, selected) consistent with MapCard
    - Category colors remain domain-specific
    - Theme switching works correctly
  </done>
</task>

</tasks>

<verification>
1. Run `npm run dev` and load dashboards with each card type
2. For each card (Pie, Histogram, Scatter):
   - Verify renders correctly in dark mode
   - Toggle to light mode - verify colors update
   - Test interactions (hover, click/select) - states visible
3. Search for remaining hardcoded theme colors:
   ```bash
   grep -E "#1e293b|#ffffff|#e2e8f0|#374151" PieChartCard.vue HistogramCard.vue ScatterCard.vue
   ```
   Should return 0 matches (or only in comments)
4. Verify all three cards have consistent interaction state colors when applicable
</verification>

<success_criteria>
1. PieChartCard uses StyleManager for background, text, and border colors
2. HistogramCard uses StyleManager for all theme-dependent colors including bar colors
3. ScatterCard uses StyleManager for theme colors and interaction states
4. All three cards respond to theme changes without page refresh
5. Visual consistency across all cards (same hover orange, same selected blue where applicable)
6. Category/domain colors remain unchanged (not theme-dependent)
</success_criteria>

<output>
After completion, create `.planning/phases/01-theming-foundation/01-03-SUMMARY.md`
</output>
