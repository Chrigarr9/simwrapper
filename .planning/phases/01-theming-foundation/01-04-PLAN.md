---
phase: 01-theming-foundation
plan: 04
type: execute
wave: 3
depends_on: ["01-02", "01-03"]
files_modified:
  - src/plugins/interactive-dashboard/InteractiveDashboard.vue
  - src/plugins/interactive-dashboard/components/cards/DataTableCard.vue
  - src/plugins/interactive-dashboard/components/cards/LinkableCardWrapper.vue
autonomous: true

must_haves:
  truths:
    - "InteractiveDashboard initializes StyleManager on mount"
    - "Data table uses CSS variables for row states (hover, selected, filtered)"
    - "CSS variables available to all dashboard components"
  artifacts:
    - path: "src/plugins/interactive-dashboard/InteractiveDashboard.vue"
      provides: "Theme initialization on dashboard load"
      contains: "initializeTheme"
    - path: "src/plugins/interactive-dashboard/components/cards/DataTableCard.vue"
      provides: "Theme-aware data table"
      contains: "var(--dashboard-"
  key_links:
    - from: "InteractiveDashboard.vue"
      to: "StyleManager"
      via: "initializeTheme() call in mounted"
      pattern: "initializeTheme\\(\\)"
    - from: "DataTableCard styles"
      to: "--dashboard-interaction-* variables"
      via: "CSS variable usage for row states"
      pattern: "var\\(--dashboard-interaction-(hover|selected)"
---

<objective>
Complete the theming integration by initializing StyleManager in InteractiveDashboard, updating the data table styling, and ensuring CSS variables cascade to all child components.

Purpose: This plan connects the StyleManager infrastructure to the dashboard lifecycle and completes the migration of all interactive dashboard components.

Output: Fully themed interactive dashboard with centralized color control.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-theming-foundation/01-CONTEXT.md
@.planning/phases/01-theming-foundation/01-01-SUMMARY.md
@.planning/phases/01-theming-foundation/01-02-SUMMARY.md
@.planning/phases/01-theming-foundation/01-03-SUMMARY.md
@src/plugins/interactive-dashboard/InteractiveDashboard.vue
@src/plugins/interactive-dashboard/managers/StyleManager.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize StyleManager in InteractiveDashboard</name>
  <files>src/plugins/interactive-dashboard/InteractiveDashboard.vue</files>
  <action>
Add StyleManager initialization to InteractiveDashboard.vue:

1. **Import initializeTheme** (at top of script section, ~line 288):
   ```typescript
   import { initializeTheme } from './managers/StyleManager'
   ```

2. **Call initializeTheme in mounted()** (~line 1559, early in mounted):
   ```typescript
   async mounted() {
     // Initialize theme CSS variables FIRST, before any rendering
     initializeTheme()

     window.addEventListener('resize', this.resizeAllCards)
     // ... rest of mounted
   }
   ```

3. **Verify CSS variables are scoped correctly**:
   - StyleManager injects into :root, which means variables are global
   - This is intentional - all dashboard components can access them
   - Document this in a comment:
   ```typescript
   // Initialize dashboard theme (injects CSS variables into :root)
   // This must happen before dashboard content renders
   initializeTheme()
   ```

4. **No cleanup needed in beforeDestroy**:
   - CSS variables persist in :root, which is fine
   - StyleManager singleton persists, which is fine (it's app-level, not component-level)

Note: YAML cluster color parsing was added in Plan 01-02, Task 4. This task focuses on ensuring the base initialization is present.
  </action>
  <verify>
    - Load any interactive dashboard
    - Check devtools :root - CSS variables with --dashboard- prefix exist
    - Variables have correct values for current theme (dark mode by default)
  </verify>
  <done>
    - StyleManager initialized when dashboard loads
    - CSS variables available to all child components
    - Theme state synced with Vuex store
  </done>
</task>

<task type="auto">
  <name>Task 2: Update data table styling to use CSS variables</name>
  <files>src/plugins/interactive-dashboard/InteractiveDashboard.vue</files>
  <action>
Update the embedded data table styling in InteractiveDashboard.vue to use CSS variables:

1. **Update .table-card-frame styles** (~line 1862-1896):
   ```scss
   .table-card-frame {
     flex: 1;
     min-height: 300px;
     max-height: 500px;
     display: flex;
     flex-direction: column;
     background: var(--dashboard-bg-secondary);

     &.is-fullscreen {
       max-height: none;
       height: 100%;
       background: var(--dashboard-bg-primary);
     }
   }
   ```

2. **Update .data-table styles** (~line 1904-1997):
   ```scss
   .data-table {
     width: 100%;
     border-collapse: collapse;
     font-size: 0.85rem;

     thead {
       position: sticky;
       top: 0;
       background: var(--dashboard-bg-secondary);
       z-index: 10;

       th {
         padding: 0.5rem 0.75rem;
         text-align: left;
         font-weight: 600;
         border-bottom: 2px solid var(--dashboard-border-default);
         color: var(--dashboard-text-primary);
         // ...

         &:hover {
           background: var(--dashboard-bg-tertiary);
         }

         &.sorted {
           color: var(--dashboard-interaction-selected);
         }
       }
     }

     tbody {
       tr {
         border-bottom: 1px solid var(--dashboard-border-subtle);
         // ...

         &:hover {
           background: var(--dashboard-bg-tertiary);
         }

         // Filtered rows - use interaction.selected with low opacity
         &.is-filtered {
           background-color: rgba(var(--dashboard-interaction-selected-rgb, 59, 130, 246), 0.1);
           border-left: 3px solid var(--dashboard-interaction-selected);
         }

         // Hovered from external component (e.g., map hover -> table highlight)
         &.is-hovered {
           background: rgba(var(--dashboard-interaction-hover-rgb, 251, 191, 36), 0.25);
         }

         // Selected rows
         &.is-selected {
           background: rgba(var(--dashboard-interaction-selected-rgb, 59, 130, 246), 0.25);
         }

         td {
           color: var(--dashboard-text-primary);
         }
       }
     }
   }
   ```

3. **Note on rgba with CSS variables**:
   - CSS variables can't be used directly in rgba() without CSS color-mix or custom properties
   - Option A: Keep hardcoded rgba values as fallback (simpler)
   - Option B: Add RGB variants to StyleManager (--dashboard-interaction-selected-rgb: 59, 130, 246)
   - Recommend Option A for now - the colors are consistent even if not variable-based

4. **Update remaining hardcoded colors** in data table styles:
   - Search for `#3b82f6`, `#2563eb`, `#fbbf24`, etc.
   - Replace direct color references with CSS variables where possible
  </action>
  <verify>
    - Data table headers readable in both themes
    - Hover state on rows visible
    - Filtered rows have blue left border and tint
    - Selected rows have distinct background
    - Sort indicator visible on sorted column
  </verify>
  <done>
    - Data table uses CSS variables for theme colors
    - Row states (hover, selected, filtered) visually consistent
    - Fullscreen mode uses correct background
  </done>
</task>

<task type="auto">
  <name>Task 3: Update remaining dashboard component styles</name>
  <files>
    src/plugins/interactive-dashboard/InteractiveDashboard.vue
    src/plugins/interactive-dashboard/components/cards/LinkableCardWrapper.vue
    src/plugins/interactive-dashboard/components/cards/DataTableCard.vue
  </files>
  <action>
Update remaining components to use CSS variables:

1. **InteractiveDashboard.vue - remaining styles** (~line 1602-2013):
   - `.dashboard-header` text colors
   - `.dash-card-frame` background
   - `.header-buttons button` colors
   - `.error-text` background and border
   - `.linked-tables-section` border color

   Example updates:
   ```scss
   .dash-card-frame {
     background-color: var(--dashboard-bg-secondary);
     // ...

     h3 {
       color: var(--dashboard-interaction-selected); // Link color
     }
   }

   .header-buttons button {
     color: var(--dashboard-interaction-selected);
   }
   ```

2. **LinkableCardWrapper.vue**:
   - Check if it has any styles that need updating
   - Likely minimal as it's a wrapper component
   - Update any hardcoded colors found

3. **DataTableCard.vue** (if separate from embedded table):
   - Read the file to check current styles
   - Update to use CSS variables consistent with embedded table

4. **Verify fallback handling**:
   - For components that might render before StyleManager initializes
   - Use CSS variable syntax with fallback: `var(--dashboard-bg-primary, #ffffff)`
   - This ensures graceful degradation

5. **Add CSS variable documentation comment** at top of style section:
   ```scss
   /*
    * Dashboard theme colors via CSS variables
    * Managed by StyleManager - see managers/StyleManager.ts
    * Variables: --dashboard-bg-*, --dashboard-text-*, --dashboard-border-*,
    *            --dashboard-interaction-*, --dashboard-cluster-*, --dashboard-chart-*
    */
   ```
  </action>
  <verify>
    - All dashboard UI elements respond to theme changes
    - No unstyled or incorrectly colored elements remain
    - Card headers, buttons, error messages all use theme colors
    - grep for remaining hardcoded colors shows minimal results (only in comments or non-theme contexts)
  </verify>
  <done>
    - All interactive dashboard components use CSS variables
    - Theme switching updates entire dashboard consistently
    - Documentation added for CSS variable system
  </done>
</task>

</tasks>

<verification>
1. Run `npm run dev` and open interactive dashboard
2. Open devtools, check :root has all --dashboard-* variables
3. Toggle theme (dark/light) using existing SimWrapper UI
4. Verify all elements update:
   - Dashboard background
   - Card backgrounds
   - Table headers and rows
   - Button colors
   - Map controls
   - Charts (if visible)
5. Check for visual regressions - compare with before screenshots if available
6. Test in both modes: start in dark, switch to light, switch back to dark
</verification>

<success_criteria>
1. StyleManager.initializeTheme() called when dashboard mounts
2. CSS variables available in :root before components render
3. Data table styling uses CSS variables for all theme colors
4. All dashboard components respond to theme changes
5. No visual regressions from current behavior
6. Consistent color scheme across all interactive dashboard elements
</success_criteria>

<output>
After completion, create `.planning/phases/01-theming-foundation/01-04-SUMMARY.md`
</output>
