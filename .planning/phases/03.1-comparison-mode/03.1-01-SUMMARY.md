---
phase: 03.1-comparison-mode
plan: 01
subsystem: ui
tags: [vue3, composition-api, dashboard, comparison-mode, interactive-visualization]

# Dependency graph
requires:
  - phase: 03-correlation-analysis
    provides: Interactive dashboard with filtering, linkage, and centralized data management
provides:
  - Comparison mode toggle UI component (ComparisonToggle)
  - Baseline data propagation through LinkableCardWrapper
  - Dashboard-level comparison state management
  - Inline table comparison count display
affects: [03.1-02-histogram, 03.1-03-pie-chart, 03.1-04-scatter-table]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "v-model disabled state: Toggle disabled when no filters active (COMP-06)"
    - "effectiveShowComparison computed: showComparison AND hasActiveFilters (enforcement of comparison UX requirement)"
    - "baselineData as computed: Returns unfiltered data from dataTableManager for comparison overlay"
    - "Slot prop propagation: LinkableCardWrapper automatically exposes new props to all child cards"

key-files:
  created:
    - src/plugins/interactive-dashboard/components/controls/ComparisonToggle.vue
  modified:
    - src/plugins/interactive-dashboard/components/cards/LinkableCardWrapper.vue
    - src/plugins/interactive-dashboard/InteractiveDashboard.vue

key-decisions:
  - "ComparisonToggle uses Vue 3 Composition API <script setup> for consistency with other interactive-dashboard components"
  - "effectiveShowComparison enforces COMP-06 requirement: comparison only shows when toggle ON and filters ACTIVE"
  - "baselineData computed property prevents duplication: single source for unfiltered data"
  - "Inline table shows comparison count (X / Y format) when comparison active"

patterns-established:
  - "Comparison mode toggle pattern: disabled state, v-model binding, effectiveShowComparison computed"
  - "Baseline data flow: dataTableManager.getData() → LinkableCardWrapper.baselineData → slot prop → child cards"

# Metrics
duration: 11min
completed: 2026-01-21
---

# Phase 3.1 Plan 01: Comparison Mode Foundation Summary

**Comparison mode toggle with baseline data propagation for dashboard-wide filtered vs unfiltered visualization**

## Performance

- **Duration:** 11 min
- **Started:** 2026-01-21T19:54:53Z
- **Completed:** 2026-01-21T20:06:35Z
- **Tasks:** 3
- **Files modified:** 3 (1 created, 2 modified)

## Accomplishments
- ComparisonToggle component with disabled state when no filters active
- baselineData computed property in LinkableCardWrapper (unfiltered data from dataTableManager)
- Dashboard-level showComparison state with effectiveShowComparison computed (enforces COMP-06)
- Inline table comparison count display (X / Y format)
- All foundation props flow to child cards automatically via slot mechanism

## Task Commits

Each task was committed atomically:

1. **Task 1: Create ComparisonToggle component** - `97a4e403` (feat)
2. **Task 2: Update LinkableCardWrapper to pass baselineData** - `ccade10e` (feat)
3. **Task 3: Integrate comparison mode into InteractiveDashboard** - `0c32bda4` (feat)

## Files Created/Modified

- `src/plugins/interactive-dashboard/components/controls/ComparisonToggle.vue` - Toggle UI component with v-model support, disabled state, and StyleManager CSS variables
- `src/plugins/interactive-dashboard/components/cards/LinkableCardWrapper.vue` - Added showComparison prop and baselineData computed, exposed both to slot for child cards
- `src/plugins/interactive-dashboard/InteractiveDashboard.vue` - Added showComparison state, hasActiveFilters/effectiveShowComparison computed, rendered ComparisonToggle in table controls, added comparison count display

## Decisions Made

1. **ComparisonToggle uses Vue 3 Composition API**: For consistency with other interactive-dashboard components (LinkableCardWrapper, DashboardCard)
2. **effectiveShowComparison computed property**: Enforces COMP-06 requirement that comparison mode only shows when toggle is ON AND filters are active. Prevents confusing UI state where baseline equals filtered data.
3. **baselineData as computed property**: Single source of truth for unfiltered data. Avoids duplication and ensures reactivity when dataTableManager data changes.
4. **Inline table comparison count**: Shows "X / Y" format (filtered / total) when comparison active. Provides immediate feedback on filter impact without requiring chart inspection.
5. **Slot prop auto-propagation**: Child cards automatically receive baseline-data and show-comparison props through LinkableCardWrapper's scoped slot. No template changes needed in InteractiveDashboard for individual cards.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None - all tasks completed as planned. TypeScript check shows pre-existing errors in node_modules (deck.gl layers) and unrelated files, but no errors in modified comparison mode files.

## Next Phase Readiness

**Ready for Plan 02 (HistogramCard overlay bars):**
- baselineData prop available to all cards via LinkableCardWrapper
- showComparison prop available to all cards
- effectiveShowComparison ensures comparison only active when meaningful (filters applied)
- ComparisonToggle UI provides user control

**Ready for Plan 03 (PieChartCard concentric rings):**
- Same foundation props available

**Ready for Plan 04 (ScatterCard overlay + DataTableCard count):**
- Same foundation props available

**Blockers:** None

**Notes:**
- Cards excluded from comparison mode (CorrelationMatrixCard, MapCard) won't use these props - they'll simply ignore them
- Cards that do implement comparison (Plans 02-04) will consume baselineData when showComparison is true

---
*Phase: 03.1-comparison-mode*
*Completed: 2026-01-21*
