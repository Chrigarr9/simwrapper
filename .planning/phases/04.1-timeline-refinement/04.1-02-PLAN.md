# Plan 04.1-02: Degree Filter Control

**Phase:** 4.1 - Timeline Refinement
**Wave:** 1
**Depends On:** None

## Overview

Create a DegreeFilterControl component with multi-select checkboxes for filtering rides by degree (1, 2, 3+). Default shows only degree 2 and 3+ rides, excluding single-passenger rides. This addresses TIME-04.

## Files Modified

- `src/plugins/interactive-dashboard/components/controls/DegreeFilterControl.vue` - NEW: Multi-select checkbox control
- `src/plugins/interactive-dashboard/components/cards/TimelineCard.vue` - Integrate DegreeFilterControl, add local degree filtering

## Tasks

<task id="1">
Create `DegreeFilterControl.vue` component following ComparisonToggle.vue pattern:
1. Props interface:
   - `modelValue: Set<number>` - Currently selected degree values
2. Emit `update:model-value` for v-model compatibility
3. Define options array: `[{ value: 1, label: '1' }, { value: 2, label: '2' }, { value: 3, label: '3+' }]`
4. Template with checkboxes in horizontal row:
   - Label "Degree" followed by checkbox options
   - Each checkbox checked if `modelValue.has(option.value)`
   - onChange toggles value in Set and emits new Set
5. Style following ComparisonToggle pattern:
   - Horizontal flex container with gap
   - Theme-aware colors using CSS variables
   - Hover states on labels
</task>

<task id="2" depends_on="1">
Integrate DegreeFilterControl into TimelineCard:
1. Import DegreeFilterControl component
2. Add `selectedDegrees` ref initialized to `new Set([2, 3])` (default: exclude degree 1)
3. Add computed `degreeFilteredData` that filters `timelineData`:
   - For each item, check if `selectedDegrees.has(item.degree)` OR if degree >= 3 and `selectedDegrees.has(3)`
   - This is a LOCAL filter, not through FilterManager (affects only this card)
4. Update `trackAllocation` computed to use `degreeFilteredData` instead of `timelineData`
5. Update `renderChart()` to use `degreeFilteredData`
6. Update `renderMinimap()` to use `degreeFilteredData`
7. Add DegreeFilterControl to template in minimap-controls area (left side, zoom buttons on right)
8. Bind DegreeFilterControl v-model to `selectedDegrees`
</task>

## Verification

<verification>
1. Open dashboard with TimelineCard showing rides with mixed degrees (1, 2, 3+)
2. Verify on initial load: only degree 2 and 3+ rides are visible (degree 1 hidden)
3. Check the "1" checkbox - degree 1 rides should now appear
4. Uncheck the "2" checkbox - degree 2 rides should disappear
5. Verify minimap updates to reflect filtered rides
6. Verify track allocation recalculates when filter changes (swim lanes repack)
7. Verify filter control is positioned left of zoom buttons in minimap area
8. Run `npm run test:run` to ensure no regressions
</verification>

## Must-Haves (Goal-Backward)

**Truths (observable behaviors):**
- User sees degree filter control with checkboxes for 1, 2, 3+
- Default state shows only degree 2 and 3+ rides
- User toggles checkboxes and timeline updates immediately

**Artifacts:**
- `DegreeFilterControl.vue` exists with checkbox UI
- `TimelineCard.vue` has `selectedDegrees` ref and `degreeFilteredData` computed

**Key Links:**
- DegreeFilterControl emits `update:model-value` -> TimelineCard `selectedDegrees` updates
- `degreeFilteredData` computed depends on `selectedDegrees`
- `trackAllocation` uses `degreeFilteredData` (not raw `timelineData`)

---
autonomous: true
