---
phase: 02.1-dashboard-card-component
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/plugins/interactive-dashboard/components/DashboardCard.vue
  - src/plugins/interactive-dashboard/types/dashboardCard.ts
autonomous: true

must_haves:
  truths:
    - "DashboardCard component renders card frame with header, title, and description"
    - "DashboardCard component renders info and enlarge buttons in header"
    - "DashboardCard component provides slot for card content"
    - "Info toggle state is managed locally by DashboardCard (showInfo ref)"
  artifacts:
    - path: "src/plugins/interactive-dashboard/components/DashboardCard.vue"
      provides: "Unified card wrapper component with frame and header"
      min_lines: 100
    - path: "src/plugins/interactive-dashboard/types/dashboardCard.ts"
      provides: "TypeScript interfaces for DashboardCard props"
      exports: ["DashboardCardProps", "CardConfig"]
  key_links:
    - from: "DashboardCard.vue"
      to: "StyleManager"
      via: "CSS variable references"
      pattern: "--dashboard-"
    - from: "DashboardCard.vue"
      to: "showInfo (local ref)"
      via: "local state toggle"
      pattern: "const showInfo = ref"
---

<objective>
Create the DashboardCard component foundation with frame, header, and button rendering.

Purpose: Establish the unified card wrapper that will replace inline card frame logic scattered across InteractiveDashboard.vue. This is the foundation for consolidating all card chrome (frame, header, buttons) into a single reusable component.

Output: DashboardCard.vue component and supporting TypeScript types.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Current card frame implementation (to be replaced)
@src/plugins/interactive-dashboard/InteractiveDashboard.vue (lines 32-62, 1750-1820 for card frame styles)

# StyleManager for theme colors
@src/plugins/interactive-dashboard/managers/StyleManager.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DashboardCard TypeScript interfaces</name>
  <files>src/plugins/interactive-dashboard/types/dashboardCard.ts</files>
  <action>
Create TypeScript interfaces for DashboardCard props and card configuration:

```typescript
/**
 * Configuration for a dashboard card, derived from YAML config.
 * This matches the card objects created in InteractiveDashboard.setupRows()
 */
export interface CardConfig {
  id: string
  type: string
  title?: string
  description?: string
  info?: string
  height?: number
  width?: number
  backgroundColor?: string
  visible?: boolean
  isLoaded?: boolean
  errors?: string[]
  showHeader?: boolean
  props?: Record<string, any>
  // Linkage and layer configs passed through to content
  linkage?: any
  layers?: any[]
  [key: string]: any  // Allow additional YAML properties
}

/**
 * Props for DashboardCard component
 */
export interface DashboardCardProps {
  card: CardConfig
  isFullscreen: boolean
  isPanelNarrow: boolean
  isFullScreenDashboard: boolean
}

/**
 * Events emitted by DashboardCard
 * Note: toggle-info is NOT emitted - info toggle is managed locally by DashboardCard
 */
export interface DashboardCardEmits {
  'toggle-fullscreen': [cardId: string]
  'clear-errors': [cardId: string]
  'card-resize': [cardId: string, dimensions: { width: number; height: number }]
}
```

Export all interfaces for use by DashboardCard and InteractiveDashboard.
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit src/plugins/interactive-dashboard/types/dashboardCard.ts`</verify>
  <done>TypeScript interfaces exist and export CardConfig, DashboardCardProps, DashboardCardEmits</done>
</task>

<task type="auto">
  <name>Task 2: Create DashboardCard component with frame and header</name>
  <files>src/plugins/interactive-dashboard/components/DashboardCard.vue</files>
  <action>
Create DashboardCard.vue using Vue 2.7 Composition API with Pug template.

**Template structure (Pug):**
```pug
.dash-card-frame(
  :style="cardStyle"
  :class="frameClasses"
)
  //- Card header with title/description and buttons
  .dash-card-headers(v-if="showHeader" :class="{'fullscreen': isFullscreen}")
    .header-labels(:style="{paddingLeft: card.type === 'text' ? '4px' : ''}")
      h3 {{ card.title }}
      p(v-if="card.description") {{ card.description }}

    .header-buttons
      //- Info button (only if card has info)
      button.button.is-small.is-white(
        v-if="card.info"
        @click="toggleInfo"
        :title="showInfo ? 'Hide Info' : 'Show Info'"
      )
        i.fa.fa-info-circle

      //- Enlarge/restore button
      button.button.is-small.is-white(
        @click="handleFullscreenClick"
        :title="isFullscreen ? 'Restore' : 'Enlarge'"
      )
        i.fa.fa-expand

  //- Info panel (collapsible) - state managed LOCALLY
  .info(v-show="showInfo")
    p
    p {{ card.info }}

  //- Content slot
  .card-content-wrapper(:id="card.id" :class="{'is-loaded': card.isLoaded}")
    slot

  //- Error display
  .error-text(v-if="card.errors && card.errors.length")
    span.clear-error(@click="clearErrors") &times;
    p(v-for="err, i in card.errors" :key="i") {{ err }}
```

**Script setup:**
- Props: card (CardConfig), isFullscreen (boolean), isPanelNarrow (boolean), isFullScreenDashboard (boolean)
- Emits: 'toggle-fullscreen', 'clear-errors' (NO toggle-info - managed locally)
- Computed: showHeader (card.title || card.description), frameClasses, cardStyle (from getCardStyle logic)
- Local state: showInfo (boolean ref) - toggled by toggleInfo() method

**Local info toggle (managed by DashboardCard, NOT parent):**
```typescript
const showInfo = ref(false)

function toggleInfo() {
  showInfo.value = !showInfo.value
}
```

**cardStyle computed** - Port logic from InteractiveDashboard.getCardStyle():
- Calculate height based on card.height (multiply by 60, default 300 except for text type)
- Calculate flex based on card.width
- Apply backgroundColor if set
- Handle single-card margin adjustment
- Handle fullscreen state (position: fixed, z-index: 10000, etc.)
- Non-fullscreen cards get display: none when another card is fullscreen

**Styles (scoped SCSS):**
Copy styles from InteractiveDashboard.vue for:
- .dash-card-frame (grid layout, background, padding, border-radius)
- .dash-card-headers (flex row, line-height, padding)
- .header-labels, .header-buttons
- .info panel
- .error-text
- Responsive .is-panel-narrow variants

Use CSS variables from StyleManager (var(--dashboard-bg-secondary), etc.)

**IMPORTANT:** Do NOT include spinner-box styles - that belongs in InteractiveDashboard for loading state. The slot wrapper .card-content-wrapper should be position: relative to contain absolutely positioned content.
  </action>
  <verify>
Component renders without errors:
1. Import in test file and mount with mock card prop
2. `npm run dev` - check console for Vue warnings
  </verify>
  <done>DashboardCard.vue exists with frame, header, buttons, info panel, error display, and content slot</done>
</task>

<task type="auto">
  <name>Task 3: Add index export for new component and types</name>
  <files>src/plugins/interactive-dashboard/components/index.ts</files>
  <action>
Create or update the components index file to export DashboardCard:

```typescript
// Card components
export { default as DashboardCard } from './DashboardCard.vue'

// Re-export types
export * from '../types/dashboardCard'
```

If index.ts doesn't exist, create it. If it exists, add the new exports.

This enables clean imports:
```typescript
import { DashboardCard, CardConfig } from './components'
```
  </action>
  <verify>Import works: `import { DashboardCard } from '@/plugins/interactive-dashboard/components'`</verify>
  <done>Index file exports DashboardCard and related types</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Dev server runs: `npm run dev`
3. No Vue warnings in console about DashboardCard
4. Component file exists at expected path
5. Types are properly exported
</verification>

<success_criteria>
- DashboardCard.vue component exists with Pug template
- Component renders card frame with header, title, description
- Component renders info and enlarge buttons
- Component provides slot for card content
- Component handles info toggle LOCALLY (showInfo ref, no emit to parent)
- Component emits toggle-fullscreen event (does NOT manage fullscreen state)
- TypeScript interfaces exported and usable
- Styles match existing .dash-card-frame appearance
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-dashboard-card-component/02.1-01-SUMMARY.md`
</output>
