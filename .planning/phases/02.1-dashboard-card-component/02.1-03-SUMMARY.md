# Phase 02.1 Plan 03: Integrate DashboardCard into InteractiveDashboard Summary

**One-liner:** InteractiveDashboard now uses DashboardCard wrapper for all cards, consolidating card chrome and eliminating duplicate code.

---

## Frontmatter

```yaml
phase: 02.1
plan: 03
subsystem: interactive-dashboard
tags: [vue, refactoring, component-integration, card-wrapper]
dependency-graph:
  requires: [02.1-01, 02.1-02]
  provides: [unified-card-rendering, card-chrome-consolidation]
  affects: [02.1-04]
tech-stack:
  added: []
  patterns: [composition-over-inheritance, slot-based-content]
key-files:
  created: []
  modified:
    - src/plugins/interactive-dashboard/InteractiveDashboard.vue
decisions:
  - id: info-toggle-local
    choice: Info toggle managed locally by DashboardCard
    rationale: UI-only state does not need to be lifted to parent; simplifies InteractiveDashboard
  - id: fullscreen-state-parent
    choice: Fullscreen state managed by InteractiveDashboard, passed as prop
    rationale: Single source of truth for which card is fullscreen; DashboardCard emits event to toggle
metrics:
  duration: ~15min
  completed: 2026-01-21
```

---

## What Was Built

### Task 1: Import and Register DashboardCard

Added DashboardCard import and component registration in InteractiveDashboard.vue:

```typescript
import DashboardCard from './components/DashboardCard.vue'

// In components:
components: Object.assign({ ..., DashboardCard }, namedCharts),
```

### Task 2a: Replace Inline Card Frame with DashboardCard

Replaced the inline `.dash-card-frame` template code (approximately 120 lines) with DashboardCard component:

**Before:**
```pug
.dash-card-frame(v-for="card,j in row.cards" ...)
  .dash-card-headers(...)
    //- header labels, buttons
  .info(...)
  .spinner-box(...)
    linkable-card-wrapper(...) or component.dash-card(...)
  .error-text(...)
```

**After:**
```pug
DashboardCard(
  v-for="card, j in row.cards"
  :key="`${i}/${j}`"
  :card="card"
  :is-fullscreen="fullScreenCardId === card.id"
  :another-card-fullscreen="!!fullScreenCardId && fullScreenCardId !== card.id"
  :is-panel-narrow="isPanelNarrow"
  :is-full-screen-dashboard="isFullScreenDashboard"
  :total-cards-in-row="row.cards.length"
  :total-rows="rows.length"
  @toggle-fullscreen="toggleZoom(card)"
  @clear-errors="card.errors = []"
  @card-resize="handleCardResize"
)
  //- Card contents in slot
  linkable-card-wrapper(...) or component.dash-card(...)
```

### Task 2b: Wire Events and Add handleCardResize

Added `handleCardResize` method to propagate resize events from DashboardCard to card resizers:

```typescript
handleCardResize(cardId: string, dimensions: { width: number; height: number }) {
  if (this.resizers[cardId]) {
    this.resizers[cardId](dimensions)
  }
}
```

Cleaned up unused code:
- Removed `infoToggle` data property (now managed by DashboardCard locally)
- Removed `handleToggleInfoClick` method (no longer needed)
- Removed `getCardStyle` method (now handled by DashboardCard's `cardStyle` computed)

### Task 3: Remove Duplicate Styles

Removed styles that are now in DashboardCard.vue:
- `.dash-card-frame` entire block (grid layout, headers, buttons, spinner-box)
- `.dash-card-frame.is-panel-narrow` (responsive margin)
- `.error-text` and `.clear-error` (error display overlay)

Kept dashboard-level styles:
- `.dashboard`, `.dashboard-content`, `.dashboard-header`
- `.dash-row` and fullscreen dashboard variants
- `.dash-card` (card content styling, not frame)
- `.tabs`, `.tab-row`, `.tab-entry`
- `.table-card-frame` and data table styles
- `.favorite-icon` styles

---

## Key Implementation Details

### DashboardCard Props

DashboardCard receives all the state it needs via props:

| Prop | Type | Source |
|------|------|--------|
| `card` | CardConfig | Card config from YAML/setupRows |
| `isFullscreen` | boolean | `fullScreenCardId === card.id` |
| `anotherCardFullscreen` | boolean | `!!fullScreenCardId && fullScreenCardId !== card.id` |
| `isPanelNarrow` | boolean | From ResizeObserver on dashboard |
| `isFullScreenDashboard` | boolean | From YAML header config |
| `totalCardsInRow` | number | `row.cards.length` |
| `totalRows` | number | `rows.length` |

### Event Flow

1. **toggle-fullscreen:** DashboardCard emits when enlarge/restore button clicked or Escape pressed
   - InteractiveDashboard handles via `toggleZoom(card)` which toggles `fullScreenCardId`

2. **clear-errors:** DashboardCard emits when X button clicked in error display
   - InteractiveDashboard handles by setting `card.errors = []`

3. **card-resize:** DashboardCard emits on container resize (via ResizeObserver)
   - InteractiveDashboard handles via `handleCardResize` which calls registered resizer

### State Management Clarification

- **Fullscreen state:** Managed by InteractiveDashboard (`fullScreenCardId`)
  - Single source of truth ensures only one card fullscreen at a time
  - DashboardCard receives state via props, emits events to change

- **Info toggle state:** Managed locally by DashboardCard (`showInfo` ref)
  - UI-only state, no need to persist or sync with parent
  - Encapsulation simplifies InteractiveDashboard

---

## Verification Results

1. **Code compiles:** ESLint passes with no errors on modified file
2. **Template structure:** Pug indentation correct, DashboardCard properly wraps slot content
3. **Events wired:** All three events (toggle-fullscreen, clear-errors, card-resize) connected
4. **Styles cleaned:** Removed ~70 lines of duplicate CSS

---

## Commits

| Hash | Message |
|------|---------|
| 77eb219c | refactor(02.1-03): integrate DashboardCard wrapper into InteractiveDashboard |

---

## Deviations from Plan

None - plan executed exactly as written.

---

## Files Modified

| File | Changes |
|------|---------|
| `src/plugins/interactive-dashboard/InteractiveDashboard.vue` | Replaced inline card frame with DashboardCard wrapper, removed duplicate code/styles (-307, +152 lines net) |

---

## Next Phase Readiness

**Ready for Plan 02.1-04:** Integration complete. Next step is verification:
- Manual testing of all card types (scatter, histogram, map, data-table)
- Verify fullscreen toggle works
- Verify info toggle works
- Verify error display works
- Verify resize events propagate correctly
- Check for visual regressions

**No blockers identified.**
