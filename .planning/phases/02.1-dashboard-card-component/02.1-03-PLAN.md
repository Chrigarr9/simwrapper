---
phase: 02.1-dashboard-card-component
plan: 03
type: execute
wave: 2
depends_on: ["02.1-01", "02.1-02"]
files_modified:
  - src/plugins/interactive-dashboard/InteractiveDashboard.vue
  - src/plugins/interactive-dashboard/components/cards/SubDashboard.vue
autonomous: true

must_haves:
  truths:
    - "InteractiveDashboard uses DashboardCard to wrap each card instead of inline .dash-card-frame"
    - "Fullscreen state is managed by InteractiveDashboard and passed to DashboardCard as prop"
    - "Card content components (ScatterCard, MapCard, etc.) are rendered inside DashboardCard slot"
    - "Cards in sub-dashboards use DashboardCard identically to main dashboard"
  artifacts:
    - path: "src/plugins/interactive-dashboard/InteractiveDashboard.vue"
      provides: "Dashboard using DashboardCard wrapper"
      contains: "DashboardCard"
    - path: "src/plugins/interactive-dashboard/components/cards/SubDashboard.vue"
      provides: "Sub-dashboard with same card architecture"
  key_links:
    - from: "InteractiveDashboard.vue"
      to: "DashboardCard.vue"
      via: "component import and usage"
      pattern: "<DashboardCard"
---

<objective>
Refactor InteractiveDashboard to use DashboardCard wrapper for all cards.

Purpose: Replace the inline card frame template code in InteractiveDashboard with DashboardCard components. This consolidates card chrome logic and ensures consistent behavior across all card types and contexts (main dashboard, sub-dashboards).

Output: InteractiveDashboard.vue refactored to use DashboardCard; SubDashboard gets consistent behavior.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# DashboardCard component (from prior plans)
@src/plugins/interactive-dashboard/components/DashboardCard.vue

# Current InteractiveDashboard template structure
@src/plugins/interactive-dashboard/InteractiveDashboard.vue

# SubDashboard that embeds InteractiveDashboard
@src/plugins/interactive-dashboard/components/cards/SubDashboard.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Import and register DashboardCard in InteractiveDashboard</name>
  <files>src/plugins/interactive-dashboard/InteractiveDashboard.vue</files>
  <action>
Add DashboardCard import and component registration.

**Add import:**
```typescript
import DashboardCard from './components/DashboardCard.vue'
```

**Add to components:**
```typescript
export default defineComponent({
  name: 'InteractiveDashboard',
  components: Object.assign(
    { TopSheet, LinkableCardWrapper, DataTableCard, LinkedTableCard, SubDashboard, DashboardCard },
    namedCharts
  ),
  // ...
})
```

This enables `<DashboardCard>` usage in the template.
  </action>
  <verify>No import errors, component recognized in template</verify>
  <done>DashboardCard imported and registered in InteractiveDashboard</done>
</task>

<task type="auto">
  <name>Task 2: Replace inline card frame with DashboardCard in template</name>
  <files>src/plugins/interactive-dashboard/InteractiveDashboard.vue</files>
  <action>
Replace the inline `.dash-card-frame` template code with DashboardCard component.

**Current template structure (lines 32-176 approximately):**
```pug
.dash-card-frame(v-for="card,j in row.cards" ...)
  .dash-card-headers(...)
    //- header labels, buttons
  .info(...)
  .spinner-box(...)
    linkable-card-wrapper(...) or component.dash-card(...)
  .error-text(...)
```

**Replace with:**
```pug
//- each card here
DashboardCard(
  v-for="card, j in row.cards"
  :key="`${i}/${j}`"
  :card="card"
  :is-fullscreen="fullScreenCardId === card.id"
  :fullscreen-card-id="fullScreenCardId"
  :is-panel-narrow="isPanelNarrow"
  :is-full-screen-dashboard="isFullScreenDashboard"
  @toggle-fullscreen="toggleZoom(card)"
  @toggle-info="handleToggleInfoClick(card)"
  @clear-errors="card.errors = []"
  @card-resize="handleCardResize"
)
  //- Spinner background (shown until card is loaded)
  .spinner-box(:class="{'is-loaded': card.isLoaded}")
    //- Linkable cards with managers
    linkable-card-wrapper(
      v-if="(card.linkage || hasLayerLinkage(card) || card.type === 'data-table') && filterManager && linkageManager && dataTableManager"
      :card="card"
      :filter-manager="filterManager"
      :linkage-manager="linkageManager"
      :data-table-manager="dataTableManager"
    )
      template(v-slot="{ filteredData, hoveredIds, selectedIds, handleFilter, handleHover, handleSelect }")
        component.dash-card(v-if="card.visible"
          :is="getCardComponent(card)"
          //- ... all existing props ...
        )

    //- Non-linkable cards
    component.dash-card(v-else-if="card.visible"
      :is="getCardComponent(card)"
      //- ... all existing props ...
    )
```

**Key changes:**
1. DashboardCard wraps the entire card including spinner-box
2. Pass fullscreen state as props (not managed here anymore, but InteractiveDashboard still owns the state)
3. Handle events from DashboardCard
4. Remove inline `.dash-card-headers`, `.info`, `.error-text` - DashboardCard handles these
5. Keep spinner-box inside the slot - DashboardCard's slot is where loading indicator goes

**Add handleCardResize method:**
```typescript
handleCardResize(cardId: string, dimensions: { width: number; height: number }) {
  // If a card has registered a resizer, call it
  if (this.resizers[cardId]) {
    this.resizers[cardId](dimensions)
  }
}
```

**IMPORTANT:** The opacity system for cards (`this.opacity[card.id]`) should be passed through to content. Keep the `:style="{opacity: opacity[card.id]}"` on the inner component.dash-card element.
  </action>
  <verify>
1. Cards render with frame, header, buttons
2. Fullscreen toggle works
3. Info toggle works
4. Error display works
5. Loading spinner appears until isLoaded
  </verify>
  <done>InteractiveDashboard template uses DashboardCard wrapper for all cards</done>
</task>

<task type="auto">
  <name>Task 3: Remove duplicate styles from InteractiveDashboard</name>
  <files>src/plugins/interactive-dashboard/InteractiveDashboard.vue</files>
  <action>
Remove card frame styles that are now in DashboardCard.

**Styles to REMOVE from InteractiveDashboard.vue (they're now in DashboardCard):**
- .dash-card-frame (entire block)
- .dash-card-headers
- .header-labels (if exists)
- .header-buttons
- .info panel styles
- .error-text
- .clear-error

**Styles to KEEP in InteractiveDashboard.vue:**
- .dashboard (main container)
- .dashboard-content
- .dashboard-header (dashboard title, not card header)
- .dash-row
- .tabs, .tab-row, .tab-entry
- .table-card-frame (data table at bottom)
- .data-table styles
- .linked-tables-section
- .sub-dashboards-section
- .spinner-box (loading indicator - this is still in InteractiveDashboard slot)
- .dash-card (the actual card content styling)

**Also keep:** Any styles with .is-fullscreen-dashboard, .is-panel-narrow variants that affect row layout (not card frame).

The goal: InteractiveDashboard handles dashboard-level layout; DashboardCard handles individual card chrome.
  </action>
  <verify>No visual regression - cards still look the same with styles in DashboardCard</verify>
  <done>InteractiveDashboard styles cleaned up, no duplicate card frame styles</done>
</task>

</tasks>

<verification>
1. `npm run dev` - dashboard loads without errors
2. Cards render with correct frame appearance (background, padding, rounded corners)
3. Card headers show title and description
4. Info button toggles info panel
5. Enlarge button triggers fullscreen
6. Fullscreen card covers viewport
7. Escape exits fullscreen
8. Other cards hidden when one is fullscreen
9. Cards resize properly after fullscreen exit
10. Loading spinner visible until card loads
11. Error messages display correctly
</verification>

<success_criteria>
- InteractiveDashboard uses DashboardCard component for all cards
- No inline card frame template code in InteractiveDashboard
- Card chrome (frame, header, buttons) rendered by DashboardCard
- Fullscreen state managed by InteractiveDashboard, passed to DashboardCard as prop
- No visual regression from current appearance
- All card types (scatter, histogram, map, table) render correctly
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-dashboard-card-component/02.1-03-SUMMARY.md`
</output>
