---
phase: 02.1-dashboard-card-component
plan: 04
type: execute
wave: 3
depends_on: ["02.1-03"]
files_modified:
  - src/plugins/interactive-dashboard/components/cards/ScatterCard.vue
  - src/plugins/interactive-dashboard/components/cards/HistogramCard.vue
  - src/plugins/interactive-dashboard/components/cards/MapCard.vue
  - src/plugins/interactive-dashboard/components/cards/DataTableCard.vue
autonomous: false

must_haves:
  truths:
    - "User sees consistent card frame appearance across all card types"
    - "User clicks enlarge on any card type and it expands to fullscreen correctly"
    - "User exits fullscreen and all cards resize properly (no scatter plot overflow)"
    - "Cards in sub-dashboards behave identically to cards in main dashboard"
  artifacts:
    - path: "src/plugins/interactive-dashboard/components/cards/ScatterCard.vue"
      provides: "Scatter chart using DashboardCard resize events"
    - path: "src/plugins/interactive-dashboard/components/cards/MapCard.vue"
      provides: "Map using DashboardCard resize events"
  key_links:
    - from: "ScatterCard.vue"
      to: "Plotly.Plots.resize"
      via: "window resize listener"
      pattern: "Plotly\\.Plots\\.resize"
---

<objective>
Verify and clean up content components to work properly with DashboardCard wrapper.

Purpose: Ensure ScatterCard, HistogramCard, MapCard, and DataTableCard properly handle resize events and have no duplicate frame/button logic. This is the final verification step to confirm the architecture refactor is complete.

Output: Clean content components that render only visualization, properly handling resize.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# DashboardCard integration (from prior plans)
@src/plugins/interactive-dashboard/InteractiveDashboard.vue

# Content components to verify
@src/plugins/interactive-dashboard/components/cards/ScatterCard.vue
@src/plugins/interactive-dashboard/components/cards/HistogramCard.vue
@src/plugins/interactive-dashboard/components/cards/MapCard.vue
@src/plugins/interactive-dashboard/components/cards/DataTableCard.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify ScatterCard resize handling</name>
  <files>src/plugins/interactive-dashboard/components/cards/ScatterCard.vue</files>
  <action>
Verify ScatterCard properly resizes when fullscreen changes.

**Current implementation (lines 422-453):**
ScatterCard already has:
- ResizeObserver on plotContainer
- window.addEventListener('resize', handleResize)

**Verify this is sufficient:**
1. ResizeObserver triggers on container size change
2. window resize event triggers on fullscreen exit (DashboardCard now dispatches this)
3. Plotly.Plots.resize() is called on both

**If any issues found:**
- Ensure handleResize calls Plotly.Plots.resize(plotContainer.value)
- Ensure observer is disconnected on unmount

**No changes should be needed** if existing implementation is correct. This task is verification.

If changes ARE needed, ensure:
```typescript
function handleResize() {
  if (plotContainer.value) {
    Plotly.Plots.resize(plotContainer.value)
  }
}
```
  </action>
  <verify>
1. Open dashboard with ScatterCard
2. Click enlarge on ScatterCard
3. Chart fills fullscreen viewport
4. Click restore/press Escape
5. Chart returns to normal size without overflow
  </verify>
  <done>ScatterCard properly resizes on fullscreen entry/exit</done>
</task>

<task type="auto">
  <name>Task 2: Verify HistogramCard resize handling</name>
  <files>src/plugins/interactive-dashboard/components/cards/HistogramCard.vue</files>
  <action>
Verify HistogramCard properly resizes when fullscreen changes.

**Current implementation:**
HistogramCard uses Plotly with `responsive: true` option (line 202). Check if it also needs explicit resize handling.

**If Plotly responsive: true is not enough:**
Add window resize listener similar to ScatterCard:
```typescript
import { onMounted, onUnmounted, nextTick } from 'vue'

function handleResize() {
  if (plotContainer.value) {
    Plotly.Plots.resize(plotContainer.value)
  }
}

onMounted(() => {
  window.addEventListener('resize', handleResize)
  // ... existing onMounted code
})

onUnmounted(() => {
  window.removeEventListener('resize', handleResize)
})
```

**Note:** Plotly's `responsive: true` should handle most resize cases, but explicit resize on fullscreen toggle may be needed for immediate response.

Test before making changes - the existing implementation might be sufficient.
  </action>
  <verify>
1. Open dashboard with HistogramCard
2. Click enlarge on HistogramCard
3. Chart fills fullscreen viewport
4. Click restore/press Escape
5. Chart returns to normal size without overflow
  </verify>
  <done>HistogramCard properly resizes on fullscreen entry/exit</done>
</task>

<task type="auto">
  <name>Task 3: Verify DataTableCard has no frame logic</name>
  <files>src/plugins/interactive-dashboard/components/cards/DataTableCard.vue</files>
  <action>
Verify DataTableCard renders ONLY table content, no card frame or fullscreen buttons.

**Check for and REMOVE if present:**
- Any `.dash-card-frame` wrapper
- Any fullscreen/enlarge button (should be in DashboardCard now)
- Any duplicate header rendering

**Current state (per STATE.md):**
"DataTableCard had its own enlarge button duplicating the dashboard-level one" - this was identified as a problem. Verify it has been removed or remove it now.

**DataTableCard should contain:**
- .data-table-card wrapper (for the table itself)
- .table-controls (scroll toggle, reset filter button - these are TABLE controls, not card chrome)
- .table-wrapper with table content

**DataTableCard should NOT contain:**
- Card frame (.dash-card-frame)
- Card header (.dash-card-headers)
- Fullscreen toggle button
- Info toggle button

The comment on line 21 says "Note: Fullscreen is handled by dashboard-level card header, not here" - verify this is accurate.
  </action>
  <verify>
1. DataTableCard renders only table, no card frame
2. No duplicate fullscreen button in DataTableCard
3. Scroll toggle and Reset button still work (these are table controls)
  </verify>
  <done>DataTableCard renders only table content, no duplicate frame/buttons</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete DashboardCard architecture refactor:
1. DashboardCard wrapper component handles card frame, header, buttons, fullscreen styling
2. InteractiveDashboard uses DashboardCard for all cards
3. Content components (Scatter, Histogram, Map, Table) render only their visualization
4. Resize events properly propagated on fullscreen changes
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open a dashboard with multiple card types (scatter, histogram, map, table)
3. **Test consistent appearance:**
   - All cards have same frame style (background, padding, rounded corners)
   - All cards have header with title and enlarge button
4. **Test fullscreen on each card type:**
   - Click enlarge on ScatterCard - fills viewport, chart scales correctly
   - Press Escape - returns to normal size, no overflow
   - Click enlarge on HistogramCard - fills viewport
   - Press Escape - returns to normal
   - Click enlarge on MapCard - fills viewport
   - Press Escape - returns to normal
   - Click enlarge on DataTableCard - fills viewport
   - Press Escape - returns to normal
5. **Test sub-dashboard cards:**
   - If dashboard has sub-dashboards, click a row to show them
   - Enlarge a card in the sub-dashboard
   - Should expand to full viewport (not just sub-dashboard container)
   - Escape should restore
6. **Test no duplicate buttons:**
   - Only ONE enlarge button per card (in header)
   - No extra buttons inside content area
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe specific issues</resume-signal>
</task>

</tasks>

<verification>
1. Build succeeds: `npm run build`
2. All card types render with consistent frame
3. Fullscreen works on all card types
4. Resize properly handled on fullscreen exit
5. No duplicate buttons or frame elements
6. Sub-dashboard cards behave identically
</verification>

<success_criteria>
- [CARD-01] DashboardCard component handles card frame, header, title/description display
- [CARD-02] DashboardCard component handles enlarge/restore button and fullscreen state
- [CARD-03] DashboardCard component handles resize events and notifies child content
- [CARD-04] Content components render only their visualization, not frame/buttons
- [CARD-05] DashboardCard works identically in main dashboard and sub-dashboards

From ROADMAP success criteria:
1. User sees consistent card frame appearance across all card types (scatter, histogram, map, table)
2. User clicks enlarge on any card type and it expands to fullscreen correctly
3. User exits fullscreen and all cards resize properly (no scatter plot overflow, no missing buttons)
4. Developer adds a new card type by creating content-only component and wrapping with DashboardCard
5. Cards in sub-dashboards behave identically to cards in main dashboard
6. Fullscreen state is managed by DashboardCard, not duplicated in individual cards
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-dashboard-card-component/02.1-04-SUMMARY.md`
</output>
