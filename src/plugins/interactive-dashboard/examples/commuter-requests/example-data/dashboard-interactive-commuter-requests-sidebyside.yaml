header:
  tab: "Commuter Requests (Side-by-Side)"
  title: "Commuter Requests Analysis"
  description: "Interactive visualization with map and table side-by-side"

# Map controls configuration
map:
  controls:
    geometryType: true  # Enable geometry type selector
    colorBy: true       # Enable color-by attribute selector

  # Geometry types available for filtering layers
  geometryTypes:
    - value: all
      label: All Geometries
    - value: origin
      label: Origin Clusters
    - value: destination
      label: Destination Clusters
    - value: od
      label: Origin-Destination (Flows)

  # Attributes available for color coding
  colorBy:
    default: main_mode
    attributes:
      - attribute: main_mode
        label: Transport Mode
        type: categorical
      - attribute: origin_cluster
        label: Origin Cluster
        type: categorical
      - attribute: destination_cluster
        label: Destination Cluster
        type: categorical
      - attribute: travel_time
        label: Travel Time
        type: numeric
      - attribute: distance
        label: Distance
        type: numeric

# Central data table (triggers InteractiveDashboard)
table:
  name: "Requests"
  dataset: requests.csv
  idColumn: request_id
  visible: false
  columns:
    hide:
      - geometry_wkt
      - start_x
      - start_y
      - end_x
      - end_y
      - pax_id
      - origin
      - destination
      - modes
    formats:
      treq:
        type: time
        convertFrom: seconds
      travel_time:
        type: duration
        convertFrom: seconds
        unit: min
        decimals: 1
      ttrav_base:
        type: duration
        convertFrom: seconds
        unit: min
        decimals: 1
      wait_time:
        type: duration
        convertFrom: seconds
        unit: min
        decimals: 1
      distance:
        type: distance
        convertFrom: meters
        unit: km
        decimals: 2
      traveled_distance:
        type: distance
        convertFrom: meters
        unit: km
        decimals: 2
      euclidean_distance:
        type: distance
        convertFrom: meters
        unit: km
        decimals: 2
      max_detour:
        type: decimal
        decimals: 2
      detour_factor:
        type: decimal
        decimals: 2
      max_cost:
        type: decimal
        decimals: 2
      earliest_departure_time:
        type: time
        convertFrom: seconds
      latest_departure_time:
        type: time
        convertFrom: seconds
      earliest_arrival_time:
        type: time
        convertFrom: seconds
      latest_arrival_time:
        type: time
        convertFrom: seconds

layout:
  row1:
    # Map (left half, 6x12)
    - type: map
      title: "Requests Map"
      width: 2
      height: 12
      center: [11.57, 48.14]
      zoom: 10
      legend:
        enabled: true
        position: bottom-right
        clickToFilter: true
      tooltip:
        enabled: true
      layers:
        # Request OD lines
        - name: request_lines
          file: requests_geometries.geojson
          type: line
          visible: true
          width: 2
          opacity: 0.6
          color: "#3498db"
          filter:
            property: geometry_type
            value: od_line
          linkage:
            tableColumn: request_id
            geoProperty: request_id
            onHover: highlight
            onSelect: filter

        # Request destinations (points)
        - name: request_destinations
          file: requests_geometries.geojson
          type: circle
          visible: true
          radius: 5
          fillColor: "#e74c3c"
          fillOpacity: 0.7
          filter:
            property: geometry_type
            value: destination
          linkage:
            tableColumn: request_id
            geoProperty: request_id
            onHover: highlight
            onSelect: filter

        # Origin cluster boundaries
        - name: origin_cluster_boundaries
          file: cluster_geometries.geojson
          type: fill
          visible: true
          geometryType: origin
          fillColor: "#9b59b6"
          fillOpacity: 0.15
          lineColor: "#8e44ad"
          lineWidth: 2
          filter:
            - property: cluster_type
              value: origin
            - property: geometry_type
              value: boundary
          linkage:
            tableColumn: origin_cluster
            geoProperty: cluster_id
            onHover: highlight
            onSelect: filter

        # Destination cluster boundaries
        - name: destination_cluster_boundaries
          file: cluster_geometries.geojson
          type: fill
          visible: true
          geometryType: destination
          fillColor: "#27ae60"
          fillOpacity: 0.15
          lineColor: "#1e8449"
          lineWidth: 2
          filter:
            - property: cluster_type
              value: destination
            - property: geometry_type
              value: boundary
          linkage:
            tableColumn: destination_cluster
            geoProperty: cluster_id
            onHover: highlight
            onSelect: filter

        # OD view: Origin cluster boundaries
        - name: od_origin_boundaries
          file: cluster_geometries.geojson
          type: fill
          visible: true
          geometryType: od
          fillColor: "#3498db"
          fillOpacity: 0.15
          lineColor: "#2980b9"
          lineWidth: 2
          filter:
            - property: cluster_type
              value: od
            - property: geometry_type
              value: boundary
            - property: hull_type
              value: origin
          linkage:
            tableColumn: od_cluster
            geoProperty: cluster_id
            onHover: highlight
            onSelect: filter

        # OD view: Destination cluster boundaries
        - name: od_destination_boundaries
          file: cluster_geometries.geojson
          type: fill
          visible: true
          geometryType: od
          fillColor: "#e74c3c"
          fillOpacity: 0.15
          lineColor: "#c0392b"
          lineWidth: 2
          filter:
            - property: cluster_type
              value: od
            - property: geometry_type
              value: boundary
            - property: hull_type
              value: destination
          linkage:
            tableColumn: od_cluster
            geoProperty: cluster_id
            onHover: highlight
            onSelect: filter

        # OD flow arcs
        - name: od_flow_arcs
          file: cluster_geometries.geojson
          type: arc
          visible: true
          geometryType: od
          color: "#9b59b6"
          opacity: 0.7
          arcHeight: 0.2
          arcTilt: 25
          widthBy:
            attribute: num_requests
            scale: [4, 14]
          filter:
            - property: cluster_type
              value: od
            - property: geometry_type
              value: flow
          linkage:
            tableColumn: od_cluster
            geoProperty: cluster_id
            onHover: highlight
            onSelect: filter

    # Table (right half, 6x12)
    - type: table
      title: "Requests Data"
      width: 1
      height: 12

  row2:
    # Active Time Distribution Histogram
    - type: histogram
      title: "Active Time Distribution"
      column: treq
      binSize: 3600
      width: 2
      height: 4
      linkage:
        type: filter
        column: treq
        behavior: toggle

    # Main Mode Pie Chart
    - type: pie-chart
      title: "Main Mode Share"
      column: main_mode
      width: 1
      height: 1
      linkage:
        type: filter
        column: main_mode
        behavior: toggle
